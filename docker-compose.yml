version: '3'

services:
  db:
    image: mariadb:10.4
    container_name: mariadb
    network_mode: host
    environment:
      MARIADB_ROOT_PASSWORD: root_password
      MARIADB_DATABASE: magento
      MARIADB_USER: magento
      MARIADB_PASSWORD: magento
  elastic:
    image: elasticsearch:7.16.2
    container_name: elasticsearch
    network_mode: host
    environment:
      - "discovery.type=single-node"
      - ES_JAVA_OPTS=-Xms750m -Xmx750m
  web:
    image: ataberkylmz/magento2:2.4.2
    container_name: magento2-container
    extra_hosts:
      - "magento2.test.com:127.0.0.1"
    environment:
      DB_SERVER: 127.0.0.1
      ELASTICSEARCH_SERVER: localhost
      MAGENTO_HOST: ${GP_URL}
      VIRTUAL_HOST: ${GP_URL}
      ADMIN_USERNAME: admin
      ADMIN_PASSWORD: 123123qa
      USE_SSL: 1
      DEPLOY_SAMPLEDATA: 1
    depends_on:
      - db
      - elastic
    network_mode: host
